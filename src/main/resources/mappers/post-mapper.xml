<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="postMapper">

	<resultMap type="Tag" id="Tag_rm">
		<id property="tagNo" column="TAG_NO"/>
		<result property="tagName" column="TAG_NM"/>
	</resultMap>
	
	<select id="selectTag" resultMap="Tag_rm">
		SELECT TAG_NM
		FROM TAG
		WHERE TAG_NM LIKE '%'||#{tagName}||'%'
	</select>
	
	<resultMap type="com.movie.sns.member.model.vo.Member" id="member_rm">
	 	<id property="memberNo" column="MEMBER_NO" />
	 	<result property="memberId" 	  column="MEMBER_ID"/>
	 	<result property="memberPw" 	  column="MEMBER_PW"/>
	 	<result property="memberName" 	  column="MEMBER_NM"/>
	 	<result property="memberNickName" column="MEMBER_NICKNM"/>
	 	<result property="memberPhone" 	  column="MEMBER_PHONE"/>
	 	<result property="memberEmail"    column="MEMBER_EMAIL"/>
	 	<result property="memberAddress"  column="MEMBER_ADDR"/>
	 	<result property="enrollDate" 	  column="ENROLL_DT"/>
	 	<result property="statusCode" 	  column="STATUS_CD"/>
	 	<result property="gradeCode" 	  column="GRADE_CD"/>
	 </resultMap>
	 
	 <select id="selectUser" resultMap="member_rm">
		SELECT MEMBER_NICKNM
		FROM MEMBER
		WHERE MEMBER_NICKNM LIKE '%'||#{tagName}||'%'
 	 </select>
 	 
 	 <insert id="insertPost" useGeneratedKeys="true">
 	 	
 	 	<selectKey order="BEFORE" resultType="_int" keyProperty="postNo">
 	 		SELECT SEQ_POST_NO.NEXTVAL FROM DUAL
 	 	</selectKey>
 	 	
 	 	INSERT INTO POST VALUES(#{postNo}, #{postContent}, DEFAULT, DEFAULT, DEFAULT, DEFAULT, 500, 1 )
 	 </insert>
 	 
 	 <select id="dupCheckTag" resultType="_int">
 	 	SELECT COUNT(TAG_NM)
		FROM TAG
		WHERE TAG_NM = #{tagName}
 	 </select>
	
	 <insert id="insertTag">
	 	INSERT INTO TAG VALUES(SEQ_TAG_CD.NEXTVAL, #{tagName})
	 </insert>

	 <insert id="insertPostTag">
	 	INSERT INTO POST_TAG VALUES(#{postNo}, (SELECT TAG_NO FROM TAG WHERE TAG_NM = #{tagName}))
	 </insert>
	
</mapper>
