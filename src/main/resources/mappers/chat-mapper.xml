<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace = "chatMapper">
 
 
 
 
 	<resultMap type="ChatRoom" id="chatRoom_rm"> <!-- 필드명과 db명이 일치하지않을때 mapping 하는 것 거의 사용  -->
		<id property="chatRoomNo" column="CHAT_ROOM_NO"/>
		<result property="statusCode" column="STATUS_CD"/>
		<result property="memberNo" column="MEMBER_NO"/>
		<result property="memberName" column="MEMBER_NM"/>
		<result property="friendNo" column="CHAT_FR_NO"/>
	
	
	</resultMap>
 	
 	<!-- 	<resultMap type="MemberImg" id="memberImage_rm">

		<id property="imgNo" column="MEMBER_IMG_NO" />
		<result property="imgPath" column="MEMBER_IMG_PATH" />
		<result property="imgName" column="MEMBER_IMG_NM" />
		<result property="imgOriginal" column="MEMBER_IMG_ORIGINAL" />
		<result property="memberNo" column="MEMBER_NO" />

	  </resultMap>
 	 -->
 	
	 <resultMap type="MEMBER" id="member_rm">
	 
	 	<id property="memberNo" column="MEMBER_NO" />
	 
	 	<result property="memberName" 	 		column="MEMBER_NM"/>
	 	<result property="memberNickName" 	 	column="MEMBER_NICKNM"/>
	 	<result property="memberPw" 	 		column="MEMBER_PW"/>
	 	<result property="memberEmail" 	 		column="MEMBER_EMAIL"/>
	 	<result property="enrollDate"   		column="ENROLL_DT"/>
	 	<result property="modifyDate" 			column="MODIFY_DT"/>
	 	<result property="memberStatusCode" 	 column="STATUS_CD"/>
	 	<result property="memberGradeCode" 	 	column="GRADE_CD"/>
	 
	 	
 	<!-- 	<collection property="imgList" column="MEMBER_NO"
			javaType="java.util.ArrayList" ofType="memberImage"
			select="selectMemberImgList" />
 	 -->
	 
	 </resultMap>
	 
 	<!-- 회원 이미지 조회  -->
	<!-- <select id="selectMemberImgList" resultMap="memberImage_rm">
		SELECT* FROM
		MEMBER_IMG
		WHERE MEMBER_NO = #{memberNo}
		ORDER BY IMG_LEVEL

	</select> -->
 	
 	
 	
 	
 	
 	<resultMap type="chatMessage" id="chatMessage_rm">
 		<id property="chatMessageNo" column="CM_NO"/>
 		<result property="createDate" column="CREATE_DT"/>
 		<result property="chatRoomNo" column="CHAT_ROOM_NO"/>
 		<result property="memberNo" column="MEMBER_NO"/>
 		<result property="memberName" column="MEMBER_NM"/>
 		<result property="memberId" column="MEMBER_ID"/>
 
 	</resultMap>
 	
 	
 	 	<!-- 채팅방 목록 조회 (상관커리) -->
 	<select id="chatRoomList" resultMap="chatRoom_rm">

	SELECT CHAT_ROOM_NO,MEMBER_NM,MEMBER_NO,
	(SELECT MEMBER_NO FROM CHAT_ROOM_JOIN J WHERE J.CHAT_ROOM_NO = R.CHAT_ROOM_NO AND MEMBER_NO != #{memberNo})CHAT_FR_NO
	FROM CHAT_ROOM Rd
	JOIN MEMBER USING(MEMBER_NO)
	WHERE R.STATUS_CD = 1
	AND MEMBER_NO = #{memberNo}
	ORDER BY 1 DESC
 	</select>
 	
 	<!-- 채팅방 참여인원이름 조회  -->
 	<select id="chatFriends">
 	
 	</select>
 	
</mapper>
