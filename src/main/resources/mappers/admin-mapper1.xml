<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="adminMapper1">

	<resultMap type="AdminPost" id="adminPost_rm">

		<id property="postNo" column="POST_NO" />
		<result property="memberNm" column="MEMBER_NM" />
		<result property="postContent" column="POST_CONTENT" />
		<result property="readCount" column="READ_COUNT" />
		<result property="likeCount" column="LIKE_COUNT" />
		<result property="createDt" column="CREATE_DT" />
		<result property="modifyDt" column="MODIFY_DT" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="statusNm" column="POST_STATUS_NM" />
		<result property="status" column="POST_STATUS_CD" />
		<result property="blind" column="BLIND_POST_CONTENT" />
	</resultMap>


	<resultMap type="postStatus" id="status_rm">
		<id property="statusCd" column="POST_STATUS_CD" />
		<result property="statusNm" column="POST_STATUS_NM" />
	</resultMap>

	<select id="postCount" resultType="_int">
		SELECT COUNT(*) FROM POST

		<if test="inputResult != ''">

			<if test="searchPost != null">
				<choose>
					<when test="searchPost == 'memberNo'">
						WHERE MEMBER_NO = #{inputResult}

					</when>
					<when test="searchPost == 'memberNm'">
						JOIN MEMBER USING(MEMBER_NO)
						WHERE MEMBER_NM LIKE
						#{inputResult}||'%'
						OR MEMBER_NM
						LIKE '%'||#{inputResult}||'%'

					</when>
					<when test="searchPost == 'postNo'">

						WHERE POST_NO = #{inputResult}
					</when>
					<when test="searchPost == 'status'">
						JOIN
						POST_STATUS
						USING(POST_STATUS_CD)
						WHERE
						POST_STATUS_NM LIKE '%'||#{inputResult}||'%'
					</when>
				</choose>

			</if>

		</if>

	</select>


	<select id="adminPost" resultMap="adminPost_rm">
		SELECT POST_NO , MEMBER_NM,
		POST_CONTENT , READ_COUNT ,
		LIKE_COUNT,
		TO_CHAR(POST.CREATE_DT ,
		'YYYY-MM-DD') CREATE_DT,
		TO_CHAR(POST.MODIFY_DT , 'YYYY-MM-DD')
		MODIFY_DT,
		MEMBER_NO ,
		POST_STATUS_NM,
		POST_STATUS_CD
		FROM POST
		JOIN
		POST_STATUS
		USING(POST_STATUS_CD)
		JOIN
		MEMBER USING (MEMBER_NO)

		<if test="inputResult != ''">
			<if test="searchPost != null">
				<choose>
					<when test="searchPost == 'memberNo'">
						WHERE MEMBER_NO = #{inputResult}

					</when>
					<when test="searchPost == 'memberNm'">
						WHERE MEMBER_NM LIKE #{inputResult}||'%'
						OR
						MEMBER_NM
						LIKE '%'||#{inputResult}||'%'

					</when>
					<when test="searchPost == 'postNo'">

						WHERE POST_NO = #{inputResult}
					</when>
					<when test="searchPost == 'status'">
						WHERE POST_STATUS_NM LIKE '%'||#{inputResult}||'%'
					</when>
				</choose>
			</if>
		</if>
		ORDER BY POST_NO DESC
	</select>

	<update id="changeStatus">
		UPDATE POST SET POST_STATUS_CD = #{status}
		WHERE
		POST_NO = #{postNo}
	</update>

	<insert id="blind">
		INSERT INTO BLIND_POST VALUES(SEQ_BLIND_NO.NEXTVAL
		,#{blind}, DEFAULT
		,#{postNo})

	</insert>


	<select id="selectStatus" resultMap="status_rm">
		SELECT * FROM POST_STATUS
	</select>
	<select id="postView" resultMap="adminPost_rm">
		SELECT POST_NO , POST_CONTENT , READ_COUNT , LIKE_COUNT ,
		TO_CHAR(POST.CREATE_DT ,'YYYY-MM-DD') CREATE_DT,
		TO_CHAR(POST.MODIFY_DT , 'YYYY-MM-DD')MODIFY_DT,
		POST_STATUS_CD,POST_STATUS_NM , BLIND_POST_CONTENT,MEMBER_NO,
		MEMBER_NM
		FROM POST
		JOIN POST_STATUS USING(POST_STATUS_CD)
		JOIN MEMBER USING (MEMBER_NO)
		LEFT JOIN BLIND_POST USING(POST_NO)
		WHERE POST_NO = #{postNo}
	</select>

	<select id="searchStatus" resultMap="status_rm">

		SELECT POST_STATUS_CD
		FROM POST_STATUS
		JOIN POST USING(POST_STATUS_CD)
		WHERE POST_NO = #{postNo}
	</select>
	
	<delete id="deleteBlind">
	DELETE FROM BLIND_POST
	WHERE POST_NO = #{postNo}
	
	</delete>
</mapper>
